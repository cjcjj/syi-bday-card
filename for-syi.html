<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Happy Birthday Syida!</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Pacifico&display=swap');

        body {
            margin: 0; padding: 0;
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            height: 100vh; width: 100vw;
            display: flex; justify-content: center; align-items: center;
            font-family: 'Fredoka One', cursive;
            overflow: hidden; touch-action: none;
        }

        /* MUTE BUTTON */
        #mute-btn {
            position: fixed; top: 20px; right: 20px; z-index: 2000;
            padding: 10px; border-radius: 50%; border: none;
            background: rgba(255,255,255,0.8); cursor: pointer; font-size: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* LAYER 1: BACK (The Card) */
        .container {
            text-align: center;
            width: 100%; max-width: 400px;
            position: relative;
            z-index: 1; 
        }

        #card-content {
            display: none; flex-direction: column; align-items: center;
            opacity: 0; transition: opacity 1s ease;
        }

        h1 { font-family: 'Pacifico', cursive; color: #FF6B6B; font-size: 2.2rem; margin: 0 0 15px 0; }
        p { 
            color: #555; font-size: 1.1rem; 
            background: rgba(255,255,255,0.85); 
            padding: 20px; border-radius: 15px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
            pointer-events: none; 
            line-height: 1.6;
        }

        /* LAYER 2: CONFETTI CANVAS */
        #confetti { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 5; }

        /* LAYER 3: BALLOONS */
        .balloon {
            position: fixed; width: 60px; height: 80px;
            border-radius: 50% 50% 50% 50% / 40% 40% 60% 60%;
            z-index: 50; cursor: grab;
            box-shadow: inset -5px -5px 15px rgba(0,0,0,0.1);
            transform: scale(0); transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .balloon::after { content: ""; position: absolute; bottom: -50px; left: 30px; width: 1px; height: 50px; background: rgba(0,0,0,0.1); }

        /* LAYER 4: CATS */
        .happy-meme {
            position: fixed; width: 110px;
            z-index: 999; cursor: grab;
            /* REMOVED mix-blend-mode because your GIF is transparent */
            opacity: 1; user-select: none; -webkit-user-drag: none;
            transform: scale(0); transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            /* Optional: Add a slight shadow to make them pop */
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.2)); 
        }

        /* SHAKING GIFT BOX ANIMATION */
        #gift-box { 
            font-size: 80px; cursor: pointer; 
            display: inline-block;
            animation: shake 2s infinite; 
            z-index: 1000; position: relative; 
        }

        @keyframes shake {
            0% { transform: translate(0, 0) rotate(0deg); }
            2% { transform: translate(-1px, 2px) rotate(-1deg); }
            4% { transform: translate(-3px, 0px) rotate(1deg); }
            6% { transform: translate(3px, 2px) rotate(0deg); }
            8% { transform: translate(1px, -1px) rotate(1deg); }
            10% { transform: translate(-1px, 2px) rotate(-1deg); }
            12% { transform: translate(-3px, 1px) rotate(0deg); }
            14% { transform: translate(3px, 1px) rotate(-1deg); }
            16% { transform: translate(-1px, -1px) rotate(1deg); }
            18% { transform: translate(1px, 2px) rotate(0deg); }
            20% { transform: translate(0, 0) rotate(0); }
        }
        
        #audio-container { position: absolute; width: 0; height: 0; overflow: hidden; }
    </style>
</head>
<body onclick="handleScreenClick(event)">

    <button id="mute-btn" onclick="toggleMute()">üîä</button>
    <canvas id="confetti"></canvas>
    <div id="audio-container"></div>

    <div class="container">
        <div id="start-screen">
            <div id="gift-box" onclick="openGift()">üéÅ</div>
            <div style="margin-top:20px; color:#888;">Tap the gift!</div>
        </div>

        <div id="card-content">
            <h1>Happy Birthday & <br> Happy New Year!</h1>
            <p>
                Syidaaaa ~! <br>
                May you be blessed <br> with a greatness ahead! <br>
                Hope your 2026 is brighter than ever, <br>
                as full of joy as these kittens! üê±<br><br>

                Stay Slayyyyyin Gurl üíÖ -Cj
                <br>
            </p>
        </div>
    </div>

    <script>
        let entities = []; 
        let dragTarget = null;
        let lastPos = { x: 0, y: 0 };
        let isOpened = false;
        let isMuted = false;

        // --- SOUND SETUP (LOCAL FILES) ---
        // Ensure pop.mp3, meow.mp3, rustle.mp3, box.mp3, music.mp3 exist in your repo
        const popSound = new Audio('pop.mp3'); 
        const meowSound = new Audio('meow.mp3'); 
        const rustleSound = new Audio('rustle.mp3');
        const boxSound = new Audio('box.mp3'); 
        let bgMusic = new Audio('music.mp3');
        bgMusic.loop = true;

        // Function to play sound for max 1 second
        function playShortSound(sound) {
            if (isMuted) return;
            sound.currentTime = 0;
            sound.play().catch(e => console.log("Audio play failed", e));
            setTimeout(() => {
                sound.pause();
                sound.currentTime = 0;
            }, 1000);
        }

        function toggleMute() {
            isMuted = !isMuted;
            const btn = document.getElementById('mute-btn');
            btn.innerText = isMuted ? "üîá" : "üîä";
            if (bgMusic) bgMusic.muted = isMuted;
        }

        // --- GRAPHICS SETUP ---
        const canvas = document.getElementById("confetti");
        const ctx = canvas.getContext("2d");
        let parts = [];
        let heightMap = [];

        function initHeightMap() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            heightMap = new Array(Math.ceil(canvas.width)).fill(canvas.height);
        }

        function openGift() {
            if(isOpened) return;
            isOpened = true;
            initHeightMap();
            
            // 1. Play Box Sound (1 sec)
            playShortSound(boxSound);

            // 2. Start Music
            if (!isMuted) bgMusic.play().catch(e => console.log("Music require interaction"));

            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('card-content').style.display = 'flex';
            
            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2;

            setTimeout(() => {
                document.getElementById('card-content').style.opacity = '1';
                // Big initial mountain burst
                for(let i=0; i<200; i++) addConfettiPiece(centerX, centerY, true);
                releaseBalloons(centerX, centerY);
                releaseTheCats(centerX, centerY);
                animate();
            }, 100);
        }

        function handleScreenClick(e) {
            if (!isOpened) return;
            // Don't trigger if clicking mute button
            if (e.target.id === 'mute-btn') return;

            const x = e.clientX || e.touches[0].clientX;
            const y = e.clientY || e.touches[0].clientY;
            
            // Only trigger rustle if NOT clicking an interactive item
            if (e.target.tagName !== 'IMG' && !e.target.classList.contains('balloon')) {
                
                playShortSound(rustleSound); // Rustle limit 1s

                const radius = 60;
                for(let i = Math.max(0, Math.floor(x - radius)); i < Math.min(heightMap.length, x + radius); i++) {
                    heightMap[i] = canvas.height;
                }
                parts.forEach(p => {
                    if (Math.abs(p.x - x) < radius && p.stopped) {
                        p.stopped = false;
                        p.vy = -12 - Math.random() * 12;
                        p.vx = (p.x - x) * 0.4;
                    }
                });
                burstConfetti(x, y);
            }
        }

        function addConfettiPiece(x, y, isBurst = false) {
            parts.push({
                x: x, y: y,
                color: `hsl(${Math.random() * 360}, 100%, 70%)`,
                size: Math.random() * 5 + 3,
                vx: (Math.random() - 0.5) * (isBurst ? 30 : 6),
                vy: (Math.random() - 0.5) * (isBurst ? 30 : 6),
                angle: Math.random() * 2 * Math.PI,
                rotationSpeed: Math.random() * 0.2 - 0.1,
                stopped: false
            });
        }

        function burstConfetti(x, y) {
            for (let i = 0; i < 25; i++) addConfettiPiece(x, y, true);
        }

        function releaseBalloons(cx, cy) {
            const colors = ['#FF6B6B', '#4ECDC4', '#FFE66D', '#FF9F1C', '#A593E0'];
            for (let i = 0; i < 10; i++) {
                let el = document.createElement('div');
                el.className = 'balloon';
                el.style.backgroundColor = colors[i % colors.length];
                document.body.appendChild(el);
                let bObj = { element: el, type: 'balloon', x: cx - 30, y: cy - 40, vx: (Math.random() - 0.5) * 20, vy: (Math.random() - 0.5) * 20, width: 60, height: 80, isHeld: false, buoyancy: 0.15 + Math.random() * 0.1 };
                addInteraction(el, bObj);
                entities.push(bObj);
                setTimeout(() => el.style.transform = "scale(1)", 50);
            }
        }

        function releaseTheCats(cx, cy) {
            // CHANGED: Now using local file cat.gif
            const memeUrl = "cat.gif"; 
            
            for (let i = 0; i < 12; i++) {
                let el = document.createElement('img');
                el.src = memeUrl;
                el.className = 'happy-meme';
                document.body.appendChild(el);
                let cObj = { element: el, type: 'cat', x: cx - 55, y: cy - 55, vx: (Math.random() - 0.5) * 35, vy: (Math.random() - 0.5) * 35, width: 110, height: 110, isHeld: false };
                addInteraction(el, cObj);
                entities.push(cObj);
                setTimeout(() => el.style.transform = "scale(1)", 50);
            }
        }

        function addInteraction(el, obj) {
            const start = (e) => { 
                obj.isHeld = true; 
                dragTarget = obj; 
                el.style.transform = "scale(1.2)";
                
                // Interaction Sounds (1 sec limit)
                if(obj.type === 'cat') { 
                    playShortSound(meowSound); 
                } else { 
                    playShortSound(popSound); 
                }
            };
            el.addEventListener('mousedown', start);
            el.addEventListener('touchstart', (e) => { start(); e.preventDefault(); }, {passive: false});
        }

        window.addEventListener('mousemove', (e) => move(e.clientX, e.clientY));
        window.addEventListener('touchmove', (e) => move(e.touches[0].clientX, e.touches[0].clientY));
        window.addEventListener('mouseup', end);
        window.addEventListener('touchend', end);

        function move(x, y) {
            if (dragTarget && dragTarget.isHeld) {
                dragTarget.vx = x - lastPos.x; dragTarget.vy = y - lastPos.y;
                dragTarget.x = x - dragTarget.width / 2; dragTarget.y = y - dragTarget.height / 2;
            }
            lastPos = { x, y };
        }

        function end() { if (dragTarget) { dragTarget.isHeld = false; dragTarget.element.style.transform = "scale(1)"; dragTarget = null; } }

        function animate() {
            entities.forEach(ent => {
                if (!ent.isHeld) {
                    if (ent.type === 'balloon') {
                        if (ent.y > 0) { ent.vy -= ent.buoyancy; ent.vx *= 0.98; }
                        else { ent.y = 0; ent.vy *= -0.1; }
                    } else { ent.vx *= 0.99; ent.vy *= 0.99; }
                    ent.x += ent.vx; ent.y += ent.vy;
                    if (ent.x + ent.width > window.innerWidth) { ent.x = window.innerWidth - ent.width; ent.vx *= -0.8; }
                    if (ent.x < 0) { ent.x = 0; ent.vx *= -0.8; }
                    if (ent.y + ent.height > window.innerHeight) { ent.y = window.innerHeight - ent.height; ent.vy *= -0.8; }
                    if (ent.type === 'cat' && ent.y < 0) { ent.y = 0; ent.vy *= -0.8; }
                }
                ent.element.style.left = ent.x + 'px';
                ent.element.style.top = ent.y + 'px';
            });

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            parts.forEach(p => {
                if (!p.stopped) {
                    p.x += p.vx; p.y += p.vy;
                    p.vy += 0.35; p.vx *= 0.98;
                    p.angle += p.rotationSpeed;

                    let mapX = Math.floor(p.x);
                    if (mapX >= 0 && mapX < heightMap.length) {
                        if (p.y >= heightMap[mapX] - p.size) {
                            p.y = heightMap[mapX] - p.size;
                            p.stopped = true;
                            for(let i = Math.max(0, mapX-3); i < Math.min(heightMap.length, mapX+4); i++) {
                                heightMap[i] -= 1.0;
                            }
                        }
                    }
                    if (p.x < 0 || p.x > canvas.width) p.vx *= -0.6;
                }
                ctx.save();
                ctx.translate(p.x, p.y);
                ctx.rotate(p.angle);
                ctx.fillStyle = p.color;
                ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size);
                ctx.restore();
            });
            requestAnimationFrame(animate);
        }

        window.addEventListener('resize', initHeightMap);
    </script>
</body>
</html>